<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Processing Data with {mNIRS} • mNIRS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="processing-mNIRS-data_files/libs/quarto-html/popper.min.js"></script><script src="processing-mNIRS-data_files/libs/quarto-html/tippy.umd.min.js"></script><link href="processing-mNIRS-data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="processing-mNIRS-data_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Processing Data with {mNIRS}">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mNIRS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9010</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/processing-mNIRS-data.html">Processing Data with {mNIRS}</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jemarnold/mNIRS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Processing Data with {mNIRS}</h1>

      <p class="author">Jem Arnold</p>
      <p class="date">2025-08-15</p>

      <small class="dont-index">Source: <a href="https://github.com/jemarnold/mNIRS/blob/main/vignettes/processing-mNIRS-data.qmd" class="external-link"><code>vignettes/processing-mNIRS-data.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="read-data-from-file">Read Data From File<a class="anchor" aria-label="anchor" href="#read-data-from-file"></a>
</h2>
<p>We will read an example data file with two NIRS channels, recording an incremental ramp cycling assessment. A few example NIRS data files are included in the <a href="https://github.com/jemarnold/mNIRS" class="external-link">mNIRS</a> package.</p>
<p>First, we load in the <a href="https://github.com/jemarnold/mNIRS" class="external-link">mNIRS</a> package and any other required libraries. <a href="https://github.com/jemarnold/mNIRS" class="external-link">mNIRS</a> can be installed with <code>devtools::install_github("jemarnold/mNIRS")</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co">## load for data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co">## load for plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jemarnold/mNIRS" class="external-link">mNIRS</a></span><span class="op">)</span> </span>
<span><span class="co"># devtools::install_github("jemarnold/mNIRS") ## install development version</span></span></code></pre></div>
</div>
<section class="level3"><h3 id="specify-file-path">Specify file path<a class="anchor" aria-label="anchor" href="#specify-file-path"></a>
</h3>
<ul>
<li>
<code>file_path</code>: We need to specify the file path to read from. e.g. <code>r("C:\myfolder\mNIRS_file.xlsx")</code>.</li>
</ul>
<p>We will read in the <code>file_path</code> to the included example data file.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/moxy_ramp_example.xlsx"</span>, package <span class="op">=</span> <span class="st">"mNIRS"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now we can read the data file with the <code><a href="../reference/read_data.html">read_data()</a></code> function. This function will take in raw NIRS data exported from a device, and return a dataframe with the data channels we specify. See <code><a href="../reference/read_data.html">?read_data</a></code> for more details.</p>
</section><section class="level3"><h3 id="specify-column-names">Specify column names<a class="anchor" aria-label="anchor" href="#specify-column-names"></a>
</h3>
<p>We need to tell the function what column names to look for, to identify our data table in the file. The data table may not be at the very top of the file, so these column names can be anywhere in the file.</p>
<ul>
<li><p><code>nirs_columns</code>: At minimum, we need one column name defined for NIRS data.</p></li>
<li><p><code>sample_column</code>: Typically, we will also specify a column for the time or sample number of each observation.</p></li>
<li><p><code>event_column</code>: We can specify a column to indicate <em>laps</em> or specific <em>events</em> in the dataset.</p></li>
</ul>
<p>These names should be in quotations and exactly match the column headers in the file (case- and special character-sensitive). Multiple columns can be accepted for <code>nirs_columns</code>. We can rename these columns when importing our data in the format:</p>
<!-- * `nirs_columns = c(new_name1 = "file_column_name1", new_name2 = "file_column_name2")`. -->
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nirs_columns</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>new_name1 <span class="op">=</span> <span class="st">"file_column_name1"</span>, </span>
<span>                new_name2 <span class="op">=</span> <span class="st">"file_column_name2"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="other-read_data-options">Other <code>read_data()</code> options<a class="anchor" aria-label="anchor" href="#other-read_data-options"></a>
</h3>
<ul>
<li><p><code>sample_rate</code>: The sample rate of the NIRS recording can be specified if known, as number of samples per second, in Hz. If left blank, the function will estimate the sample rate from <code>sample_column</code>, assuming it contains time values.</p></li>
<li><p><code>numeric_time</code>: If <code>sample_column</code> is in a date-time format (e.g. <code>hh:mm:ss</code>), we can convert this to numeric with <code>numeric_time = TRUE</code>. This may read the date-time format as starting from a non-zero value. This can be manually corrected later with some basic data wrangling.</p></li>
<li><p><code>keep_all</code>: Once the data table in the file is identified, the default is to return only the columns names explicitly specified above. If we want to return all columns in the data table, we can set <code>keep_all = TRUE</code>.</p></li>
<li><p><code>verbose</code>: Finally, the function may return warnings or messages, for example if there are duplicate values in <code>sample_column</code> which may indicate a recording issue. These informative messages can be useful for data validation, but can be silenced with <code>verbose = TRUE</code>. Fail-state errors will always be returned.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span><span class="va">file_path</span>,</span>
<span>                      nirs_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>smo2_left <span class="op">=</span> <span class="st">"SmO2 Live"</span>,</span>
<span>                                       smo2_right <span class="op">=</span> <span class="st">"SmO2 Live(2)"</span><span class="op">)</span>,</span>
<span>                      sample_column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>time <span class="op">=</span> <span class="st">"hh:mm:ss"</span><span class="op">)</span>,</span>
<span>                      event_column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>lap <span class="op">=</span> <span class="st">"Lap"</span><span class="op">)</span>,</span>
<span>                      sample_rate <span class="op">=</span> <span class="fl">2</span>, <span class="co">## we know this file is recorded at 2 samples per second</span></span>
<span>                      numeric_time <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">## to convert the date-time string to numeric</span></span>
<span>                      keep_all <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">## to keep the returned dataframe clean</span></span>
<span>                      verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">## show warnings &amp; messages, but ignore them for now</span></span>
<span><span class="co">#&gt; Warning: "sample_column = time" has non-sequential or repeating values. Consider</span></span>
<span><span class="co">#&gt; investigating at "time = 1952, 1952, 1952, 2924.01, and 2924.01".</span></span>
<span></span>
<span><span class="co">## ignore the Warning about repeated samples here</span></span>
<span></span>
<span><span class="va">data_raw</span></span>
<span><span class="co">#&gt; # A tibble: 2,203 × 4</span></span>
<span><span class="co">#&gt;     time   lap smo2_left smo2_right</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 1740.     1        54         68</span></span>
<span><span class="co">#&gt;  2 1740.     1        54         68</span></span>
<span><span class="co">#&gt;  3 1741.     1        54         68</span></span>
<span><span class="co">#&gt;  4 1742.     1        54         66</span></span>
<span><span class="co">#&gt;  5 1742.     1        54         66</span></span>
<span><span class="co">#&gt;  6 1743.     1        54         66</span></span>
<span><span class="co">#&gt;  7 1743.     1        54         66</span></span>
<span><span class="co">#&gt;  8 1744.     1        57         67</span></span>
<span><span class="co">#&gt;  9 1744.     1        57         67</span></span>
<span><span class="co">#&gt; 10 1745.     1        57         67</span></span>
<span><span class="co">#&gt; # ℹ 2,193 more rows</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="data-wrangling">Data wrangling<a class="anchor" aria-label="anchor" href="#data-wrangling"></a>
</h2>
<p>Note our <code>time</code> column does not start at zero, because we converted from <code>hh:mm:ss</code>. Let’s quickly fix that, then we’ll plot the data.</p>
<p>We can do any other data wrangling steps here, as we would for any data file. I prefer to use <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a> for dataframe wrangling.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_time_fixed</span> <span class="op">&lt;-</span> <span class="va">data_raw</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">time</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## {mNIRS} data can be plotted with a built in call to `plot()`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_time_fixed</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="processing-mNIRS-data_files/figure-html/unnamed-chunk-4-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<section class="level3"><h3 id="metadata-stored-in-mnirs-data-dataframes">Metadata stored in <em>mNIRS.data</em> dataframes<a class="anchor" aria-label="anchor" href="#metadata-stored-in-mnirs-data-dataframes"></a>
</h3>
<p>Dataframes read or processed by <a href="https://github.com/jemarnold/mNIRS" class="external-link">mNIRS</a> functions will return <code>class = mNIRS.data</code> and contain metadata, which can be retrieved with <code>attributes(data)</code>.</p>
<p>Instead of re-defining our column names or sample rate, we can call them from the metadata. Some <a href="https://github.com/jemarnold/mNIRS" class="external-link">mNIRS</a> functions will automatically retrieve metadata if present.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nirs_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">data_raw</span><span class="op">)</span><span class="op">$</span><span class="va">nirs_columns</span></span>
<span><span class="va">nirs_columns</span></span>
<span><span class="co">#&gt; [1] "smo2_left"  "smo2_right"</span></span>
<span></span>
<span><span class="va">sample_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">data_raw</span><span class="op">)</span><span class="op">$</span><span class="va">sample_rate</span></span>
<span><span class="va">sample_rate</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="replace-outliers-invalid-values-and-missing-values">Replace Outliers, invalid Values, and Missing Values<a class="anchor" aria-label="anchor" href="#replace-outliers-invalid-values-and-missing-values"></a>
</h2>
<p>We can see some errors in the data signals, so let’s clean those up.</p>
<p>We can do some simple data wrangling steps to clean the invalid data and prepare it for digital filtering and smoothing.</p>
<ul>
<li>
<code>x</code>: These three <code>replace_*</code> functions work on vector data; they take in a single data channel (<code>x</code>), apply processing to that channel, and return a vector of the processed channel data.</li>
</ul>
<section class="level3"><h3 id="replace_outliers">
<code>replace_outliers()</code><a class="anchor" aria-label="anchor" href="#replace_outliers"></a>
</h3>
<p>We can identify local outliers using a Hampel filter and replace them with the local median value. See <code><a href="../reference/replace_outliers.html">?replace_outliers</a></code> for details.</p>
<ul>
<li><p><code>width</code>: The number of samples (window) in which to detect local outliers. To define the window in seconds, multiply the desired number of seconds by the sample rate.</p></li>
<li><p><code>t0</code>: The number of standard deviations outside of which are detected as outliers, defaulting to 3 (Pearson’s rule).</p></li>
<li><p><code>na.rm</code>: A <code>TRUE</code>/<code>FALSE</code> value indicating whether missing values (<code>NA</code>) should be ignored before the Hampel filter is applied.</p></li>
<li><p><code>return</code>: Indicates whether outliers should be replaced by the local <em>“median”</em> value or by <em>“NA”</em>.</p></li>
</ul>
<p>Note that with relatively low sample rates, such as this 2 Hz file, outlier filters may occasionally over-filter and ‘flatten’ sections of the data. This is observed in this example near the end of the file, were the data trend is quite flat already.</p>
</section><section class="level3"><h3 id="replace_invalid">
<code>replace_invalid()</code><a class="anchor" aria-label="anchor" href="#replace_invalid"></a>
</h3>
<p>Some NIRS devices or recording software can report specific invalid values, such as <code>c(0, 100, 102.3)</code>. These can be manually removed with <code><a href="../reference/replace_invalid.html">replace_invalid()</a></code>. See <code><a href="../reference/replace_invalid.html">?replace_invalid</a></code> for details.</p>
<ul>
<li><p><code>values</code>: A vector of numeric values to be replaced.</p></li>
<li><p><code>width</code>: The number of samples (window) in which the local median will be calculated. To define the window in seconds, multiply the desired number of seconds by the sample rate.</p></li>
<li><p><code>return</code>: Indicates whether invalid values should be replaced by the local <em>“median”</em> value or by <em>“NA”</em>.</p></li>
</ul></section><section class="level3"><h3 id="replace_missing">
<code>replace_missing()</code><a class="anchor" aria-label="anchor" href="#replace_missing"></a>
</h3>
<p>Finally, We can use <code><a href="../reference/replace_missing.html">replace_missing()</a></code> to interpolate across missing data. Other fill methods are available, see <code><a href="../reference/replace_missing.html">?replace_missing</a></code> for details.</p>
<ul>
<li><p><code>method</code>: Specify the method for filling missing data. The default <em>“linear”</em> interpolation is usually sufficient.</p></li>
<li><p><code>na.rm</code>: A <code>TRUE</code>/<code>FALSE</code> value indicating when leading or trailing <code>NA</code>s remain after processing, should they be included or omitted.</p></li>
<li><p><code>maxgap</code>: Specify the maximum number of consecutive <code>NA</code>s to fill. Any longer gaps will be left unchanged.</p></li>
</ul>
<p>Subsequent processing &amp; analysis steps may return errors when missing values are present. Therefore, it is a good habit to identify and deal with them early during data processing.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_cleaned</span> <span class="op">&lt;-</span> <span class="va">data_time_fixed</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>, <span class="co">## apply function across all of our `nirs_columns`</span></span>
<span>               \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="../reference/replace_outliers.html">replace_outliers</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                                      width <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="va">sample_rate</span>, <span class="co">## 20 sec window</span></span>
<span>                                      na.rm <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">## ignore `NA`</span></span>
<span>                                      return <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>, </span>
<span>               \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="../reference/replace_invalid.html">replace_invalid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, <span class="co">## known invalid values</span></span>
<span>                                     width <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="va">sample_rate</span>,</span>
<span>                                     return <span class="op">=</span> <span class="st">"NA"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>, </span>
<span>               \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="../reference/replace_missing.html">replace_missing</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                                     method <span class="op">=</span> <span class="st">"linear"</span>, <span class="co">## linear interpolation</span></span>
<span>                                     na.rm <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">## to preserve the length of the vector</span></span>
<span>                                     maxgap <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span> <span class="co">## interpolate across gaps of any length</span></span>
<span>        <span class="op">)</span>,</span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_cleaned</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="processing-mNIRS-data_files/figure-html/unnamed-chunk-6-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>That got rid of all the obvious data issues.</p>
</section></section><section class="level2"><h2 id="downsample-data">Downsample Data<a class="anchor" aria-label="anchor" href="#downsample-data"></a>
</h2>
<p>Say we are interested in phenomena occurring on a time scale of 5-minutes, and we have NIRS data recorded at 50 Hz, but something like power data recorded at only 1 Hz. It may be easier to synchronise our data and faster to work with fewer samples if we down-sample the NIRS data also to 1 Hz.</p>
<section class="level3"><h3 id="downsample_data-options">
<code>downsample_data()</code> options<a class="anchor" aria-label="anchor" href="#downsample_data-options"></a>
</h3>
<ul>
<li><p><code>data</code>: This function works on a dataframe; it will take in a dataframe (<code>data</code>), apply the processing step to all data channels, and return the processed dataframe.</p></li>
<li><p><code>sample_column</code>: If the dataframe already has <em>mNIRS.data</em> metadata, the <em>time</em> or <em>sample</em> column will be detected automatically. Otherwise, we can define or overwrite it explicitly.</p></li>
<li><p><code>sample_rate</code>: If the dataframe already has <em>mNIRS.data</em> metadata, the <em>sample_rate</em> will be detected automatically. Otherwise, we can define or overwrite it explicitly.</p></li>
<li><p><code>downsample_rate</code>: Specify the output sample rate we want to covert to, as a number of samples per second (Hz). This value should be lower than the input <code>sample_rate</code>, or else it won’t do anything.</p></li>
<li><p><code>downsample_time</code>: Alternatively, we can specify the output as a number of seconds per sample to produce the same result.</p></li>
</ul>
<p>This example dataset is already at relatively low sample rate, but let’s just see what it looks like if for some reason we wanted to down-sample further to 0.1 Hz (1 sample every 10 sec).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_downsampled</span> <span class="op">&lt;-</span> <span class="va">data_cleaned</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../reference/downsample_data.html">downsample_data</a></span><span class="op">(</span>sample_column <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">## will be automatically read from metadata</span></span>
<span>                    sample_rate <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">## will be automatically read from metadata</span></span>
<span>                    downsample_time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co">## equal to `downsample_rate = 0.1`</span></span>
<span><span class="co">#&gt; ℹ Sample rate = 2 Hz. Output is downsampled at 0.1 Hz.</span></span>
<span></span>
<span><span class="va">data_downsampled</span></span>
<span><span class="co">#&gt; # A tibble: 121 × 4</span></span>
<span><span class="co">#&gt;     time   lap smo2_left smo2_right</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1     0     1      54.1       66.7</span></span>
<span><span class="co">#&gt;  2    10     1      55.1       64.5</span></span>
<span><span class="co">#&gt;  3    20     1      55.8       65.4</span></span>
<span><span class="co">#&gt;  4    30     1      55.7       65.1</span></span>
<span><span class="co">#&gt;  5    40     1      55.5       62.8</span></span>
<span><span class="co">#&gt;  6    50     1      55.7       64.4</span></span>
<span><span class="co">#&gt;  7    60     1      55.3       66.2</span></span>
<span><span class="co">#&gt;  8    70     1      56.1       66.7</span></span>
<span><span class="co">#&gt;  9    80     1      56.8       66.4</span></span>
<span><span class="co">#&gt; 10    90     1      56.6       68.5</span></span>
<span><span class="co">#&gt; # ℹ 111 more rows</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_downsampled</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="processing-mNIRS-data_files/figure-html/unnamed-chunk-7-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The data channels certainly look smoother. This is kind of like we have taken a 10-second moving average of the data, but we have lost information by decreasing the number of samples. Our dataframe now has only <code>121</code> rows, compared to the original <code>2203</code> rows.</p>
</section></section><section class="level2"><h2 id="digital-filtering">Digital Filtering<a class="anchor" aria-label="anchor" href="#digital-filtering"></a>
</h2>
<p>If we want more precise control to improve our signal-to-noise ratio in our dataset without losing information, we should apply digital filtering to smooth the data.</p>
<section class="level3"><h3 id="choosing-a-digital-filter">Choosing a digital filter<a class="anchor" aria-label="anchor" href="#choosing-a-digital-filter"></a>
</h3>
<p>There are a few digital filtering methods available. Which option is best will depend in large part on the sample rate of the data and the frequency of the phenomena being observed.</p>
<p>Choosing filter parameters is an important processing step to improve signal-to-noise ratio and enhance our subsequent interpretations. Over-filtering the data can introduce data artefacts which can influence the signal analysis just as much as the original noisy signal.</p>
<p>It is perfectly valid to choose a digital filter by empirically testing iterative filter parameters until the signal or phenomena of interest is optimised for signal-to-noise ratio and minimal data artefacts.</p>
<p>The process of choosing a digital filter will be the topic of another vignette <code>&lt;currently under development&gt;</code>.</p>
</section><section class="level3"><h3 id="filter_data-methods">
<code>filter_data()</code> methods<a class="anchor" aria-label="anchor" href="#filter_data-methods"></a>
</h3>
<ul>
<li>
<code>x</code>: This function works on vector data; it takes in a single data channel (<code>x</code>), applies processing to that channel, and returns a vector of the processed channel data.</li>
</ul>
<section class="level4"><h4 id="smoothing-spline">Smoothing-spline<a class="anchor" aria-label="anchor" href="#smoothing-spline"></a>
</h4>
<ul>
<li>
<code>method = "smooth-spline"</code>: A non-parametric smoothing spline is often quite good as a first pass filter when first examining the data. This can often be good enough for longer time-scale phenomena, such as a 5-minute exercise interval, or an intervention with a gradual response curve. For faster occurring or repeated (square-wave) responses, a smoothing-spline may not be appropriate.</li>
</ul></section><section class="level4"><h4 id="butterworth-digital-filter">Butterworth digital filter<a class="anchor" aria-label="anchor" href="#butterworth-digital-filter"></a>
</h4>
<ul>
<li>
<code>method = "butterworth"</code>: A Butterworth low-pass digital filter is probably the most common method used in mNIRS research (whether appropriately, or not). For certain applications, such as identifying a signal with a known frequency, such as cycling/running cadence or heart rate, a pass-band or a different filter type may be better suited.</li>
</ul></section><section class="level4"><h4 id="moving-average">Moving average<a class="anchor" aria-label="anchor" href="#moving-average"></a>
</h4>
<ul>
<li>
<code>method = "moving-average"</code>: The simplest smoothing method is a simple moving average applied over a specified number of samples. Commonly, this might be a 5- or 15-second centred moving average filter.</li>
</ul></section></section><section class="level3"><h3 id="apply-the-filter">Apply the filter<a class="anchor" aria-label="anchor" href="#apply-the-filter"></a>
</h3>
<p>Let’s try a <em>Butterworth low-pass</em> filter, and we’ll specify some empirically chosen filter parameters. See <code><a href="../reference/filter_data.html">?filter_data</a></code> for further details on each of these filtering methods and their respective parameters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_filtered</span> <span class="op">&lt;-</span> <span class="va">data_cleaned</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>,</span>
<span>               \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="../reference/filter_data.html">filter_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                                 method <span class="op">=</span> <span class="st">"butterworth"</span>,</span>
<span>                                 type <span class="op">=</span> <span class="st">"low"</span>,</span>
<span>                                 n <span class="op">=</span> <span class="fl">2</span>, <span class="co">## see ?filter_data for details on filter parameters</span></span>
<span>                                 W <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co">## we will add the non-filtered data back to the plot to compare</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_filtered</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_cleaned</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smo2_left</span>, colour <span class="op">=</span> <span class="st">"smo2_left"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_cleaned</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smo2_right</span>, colour <span class="op">=</span> <span class="st">"smo2_right"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="processing-mNIRS-data_files/figure-html/unnamed-chunk-8-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="level2"><h2 id="shift-and-rescale-data">Shift and Rescale Data<a class="anchor" aria-label="anchor" href="#shift-and-rescale-data"></a>
</h2>
<p>We may need to adjust our data to normalise NIRS signal values across channels, or between individuals or trials, etc. For example, we may want to set our mean baseline value to zero for all NIRS signals. Or we may want to compare signal kinetics (the rate of change or time course of a response) after rescaling to the same relative dynamic range.</p>
<p>These functions allow us to either shift values and preserve the dynamic range (the delta amplitude from minimum to maximum values) of our NIRS channels, or rescale the data to a new dynamic range.</p>
<p>We can do this on multiple NIRS channels and either modify or preserve the relative scaling between those channels.</p>
<section class="level3"><h3 id="shift_data-options">
<code>shift_data()</code> options<a class="anchor" aria-label="anchor" href="#shift_data-options"></a>
</h3>
<p>We may want to shift our data values while preserving the absolute dynamic range. See <code><a href="../reference/shift_data.html">?shift_data</a></code> for details.</p>
<ul>
<li><p><code>data</code>: This function works on a dataframe; it will take in a dataframe (<code>data</code>), apply the processing step to all data channels, and return the processed dataframe.</p></li>
<li><p><code>nirs_columns</code>: A list specifying how we want the <em>NIRS</em> data channels to be grouped, to preserve within-group relative scaling. Listing each channel separately (e.g. <code>list("A", "B", "C")</code>) will shift each channel independently. The relative scaling between channels will be lost.<br><br>
Grouping channels (e.g. <code>list(c("A", "B"), c("C"))</code>) will shift each group of channels together. The relative scaling between channels will be preserved within each group, but lost across groups.<br><br>
If the dataframe already has <em>mNIRS.data</em> metadata, the <em>NIRS</em> data channels will be detected automatically and processed as if grouped globally together.</p></li>
<li><p><code>shift_to</code>: The <em>NIRS</em> value to which the channels will be shifted.</p></li>
<li><p><code>position</code>: Specifies how we want to shift the data; either shifting the <em>“minimum”</em>, <em>“maximum”</em>, or <em>“first”</em> sample(s) to the value specified above.</p></li>
<li><p><code>mean_samples</code>: Specifies how many samples we want to average across when shifting to our new value specified above. The default <code>mean_samples = 1</code> will shift a single value.</p></li>
<li><p><code>shift_by</code>: An alternate way to specify, if we wanted to shift a data column by, say 10 units.</p></li>
</ul>
<p>We have a 2-minute baseline for this dataset, so maybe we want to shift both NIRS signals so that the mean value of the 2-min baseline is equal to zero.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_shifted</span> <span class="op">&lt;-</span> <span class="va">data_filtered</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co">## convert `nirs_columns` to separate list items to shift each column separately</span></span>
<span>    <span class="fu"><a href="../reference/shift_data.html">shift_data</a></span><span class="op">(</span>nirs_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>,</span>
<span>               shift_to <span class="op">=</span> <span class="fl">0</span>,</span>
<span>               position <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>               mean_samples <span class="op">=</span> <span class="fl">120</span> <span class="op">*</span> <span class="va">sample_rate</span><span class="op">)</span> <span class="co">## shift the mean first 120 sec equal to zero</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_shifted</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="processing-mNIRS-data_files/figure-html/unnamed-chunk-9-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now our interpretation may change; if we are assuming the baseline represents the same starting condition, our <em>smo2_left</em> signal does not deoxygenate as far as our <em>smo2_right</em> signal.</p>
</section><section class="level3"><h3 id="rescale_data-options">
<code>rescale_data()</code> options<a class="anchor" aria-label="anchor" href="#rescale_data-options"></a>
</h3>
<p>We may want to rescale our data to a new dynamic range. See <code><a href="../reference/rescale_data.html">?rescale_data</a></code> for details.</p>
<ul>
<li><p><code>data</code>: This function works on a dataframe; it will take in a dataframe (<code>data</code>), apply the processing step to all data channels, and return the processed dataframe.</p></li>
<li><p><code>nirs_columns</code>: A list specifying how we want the <em>NIRS</em> data channels to be grouped, to preserve within-group relative scaling (see <em>Shift Data</em> above).</p></li>
<li><p><code>rescale_range</code>: Specifies the new dynamic range, in the form <code>c(minimum, maximum)</code>.</p></li>
</ul>
<p>For example, if we are interested in comparing the ‘functional range’ of each NIRS signal, we may want to set them both to 0-100%.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_rescaled</span> <span class="op">&lt;-</span> <span class="va">data_filtered</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co">## convert `nirs_columns` vector to separate list items to shift each column separately</span></span>
<span>    <span class="fu"><a href="../reference/rescale_data.html">rescale_data</a></span><span class="op">(</span>nirs_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>, </span>
<span>                 rescale_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co">## rescale to a 0-100% functional exercise range</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_rescaled</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="processing-mNIRS-data_files/figure-html/unnamed-chunk-10-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Here, our interpretation may be that <em>smo2_left</em> appears to deoxygenate slower to it’s fullest extent during incremental exercise, and reoxygenate faster compared to <em>smo2_right</em>.</p>
</section><section class="level3"><h3 id="combined-shift-and-rescale">Combined shift and rescale<a class="anchor" aria-label="anchor" href="#combined-shift-and-rescale"></a>
</h3>
<p>What if we wanted to shift both NIRS signals so their mean 120-sec baselines are equal, then rescale the dynamic range of both signals grouped, such that the highest and lowest values were from 0 to 100?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_rescaled</span> <span class="op">&lt;-</span> <span class="va">data_filtered</span> <span class="op">|&gt;</span> </span>
<span>     <span class="co">## the lowest single value for each NIRS channel will be shifted to zero</span></span>
<span>    <span class="fu"><a href="../reference/shift_data.html">shift_data</a></span><span class="op">(</span>nirs_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>,</span>
<span>               shift_to <span class="op">=</span> <span class="fl">0</span>,</span>
<span>               position <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>               mean_samples <span class="op">=</span> <span class="fl">120</span> <span class="op">*</span> <span class="va">sample_rate</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co">## Then both channels will be grouped and the maximum value of the two scaled to 100%</span></span>
<span>    <span class="fu"><a href="../reference/rescale_data.html">rescale_data</a></span><span class="op">(</span>nirs_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">nirs_columns</span><span class="op">)</span>, </span>
<span>                 rescale_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_rescaled</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="processing-mNIRS-data_files/figure-html/unnamed-chunk-11-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now our interpretation might be that assuming the same starting baseline condition in both tissues, <em>smo2_left</em> preserves greater relative oxygenation during exercise and immediate recovery compared to <em>smo2_right</em>.</p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jem Arnold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
