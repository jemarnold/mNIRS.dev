<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter Data — filter_data • mNIRS</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter Data — filter_data"><meta name="description" content="Apply signal filtering to vector data with either: 1. A cubic smoothing spline.
2. A Butterworth digital filter. 3. A simple moving average."><meta property="og:description" content="Apply signal filtering to vector data with either: 1. A cubic smoothing spline.
2. A Butterworth digital filter. 3. A simple moving average."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mNIRS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9012</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/processing-mNIRS-data.html">Processing Data with {mNIRS}</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jemarnold/mNIRS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/jemarnold/mNIRS/blob/main/R/filter_data.R" class="external-link"><code>R/filter_data.R</code></a></small>
      <div class="d-none name"><code>filter_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Apply signal filtering to vector data with either: 1. A cubic smoothing spline.
2. A Butterworth digital filter. 3. A simple moving average.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_data</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smooth-spline"</span>, <span class="st">"butterworth"</span>, <span class="st">"moving-average"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"high"</span>, <span class="st">"stop"</span>, <span class="st">"pass"</span><span class="op">)</span>,</span>
<span>  spar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">W</span>,</span>
<span>  <span class="va">fc</span>,</span>
<span>  <span class="va">sample_rate</span>,</span>
<span>  <span class="va">width</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A numeric vector.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Indicates how to filter the data (see <em>Details</em>).</p><dl><dt><code>"smooth-spline"</code></dt>
<dd><p>fits a cubic smoothing spline.</p></dd>

<dt><code>"butterworth"</code></dt>
<dd><p>uses a centred Butterworth digital filter. <code>type</code> should
be defined (see <em>Details</em>).</p></dd>

<dt><code>"moving-average"</code></dt>
<dd><p>uses a centred moving average filter.</p></dd>


</dl></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Specify the filter type. <em>Only relevant for <code>method = "butterworth"</code></em>
(see <em>Details</em>).</p><dl><dt><code>"low"</code></dt>
<dd><p>For a <em>low-pass</em> filter (<em>default</em>).</p></dd>

<dt><code>"high"</code></dt>
<dd><p>For a <em>high-pass</em> filter.</p></dd>

<dt><code>"stop"</code></dt>
<dd><p>For a <em>stop-band</em> (band-reject) filter.</p></dd>

<dt><code>"pass"</code></dt>
<dd><p>For a <em>pass-band</em> filter.</p></dd>


</dl></dd>


<dt id="arg-spar">spar<a class="anchor" aria-label="anchor" href="#arg-spar"></a></dt>
<dd><p>A numeric scalar defining the smoothing parameter for
<code>method = "smooth-spline"</code>.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>An integer scalar defining the order of a Butterworth filter for
<code>method = "butterworth"</code>.</p></dd>


<dt id="arg-w">W<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>A numeric scalar or two-element vector defining the fractional
critical frequency(ies) of a Butterworth filter for <code>method = "butterworth"</code>.</p></dd>


<dt id="arg-fc">fc<a class="anchor" aria-label="anchor" href="#arg-fc"></a></dt>
<dd><p>A numeric scalar or two-element vector defining the critical
frequency(ies) of a Butterworth filter for <code>method = "butterworth"</code>.</p></dd>


<dt id="arg-sample-rate">sample_rate<a class="anchor" aria-label="anchor" href="#arg-sample-rate"></a></dt>
<dd><p>A numeric scalar for the sample rate in Hz for
<code>method = "butterworth"</code>.</p></dd>


<dt id="arg-width">width<a class="anchor" aria-label="anchor" href="#arg-width"></a></dt>
<dd><p>A numeric scalar defining the window length of samples for
<code>method = "moving-average"</code>.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>A logical indicating whether missing values should be ignored
(<code>TRUE</code>) before the filter is applied. Otherwise (<code>FALSE</code>, the <em>default</em>) will
throw an error (see <em>Details</em>).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical. <code>TRUE</code> (the <em>default</em>) will return warnings and
messages which can be used for troubleshooting. <code>FALSE</code> will silence these
messages. Errors will always be returned.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric vector of filtered data.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<dl><dt><code>method = "smooth-spline"</code></dt>
<dd><p>applies a non-parametric cubic
smoothing spline from <code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">stats::smooth.spline()</a></code>. Smoothing is defined
by the parameter <code>spar</code>, which can be left blank and automatically
determined via penalised log liklihood. This usually works well for
smoothing responses occurring on the order of minutes or longer. Or <code>spar</code>
can be defined explicitly, typically (but not necessarily) in the range
<code>spar = [0, 1]</code>.</p></dd>

<dt><code>method = "butterworth"</code></dt>
<dd><p>applies a centred (two-pass symmetrical)
Butterworth digital filter from <code><a href="https://rdrr.io/pkg/signal/man/butter.html" class="external-link">signal::butter()</a></code> and <code><a href="https://rdrr.io/pkg/signal/man/filtfilt.html" class="external-link">signal::filtfilt()</a></code>.
The filter order is defined by <code>n</code>, typically in the range <code>n = [1, 10]</code>.
Higher filter orders tend to better capture rapid changes in amplitude,
but also cause more distortion artefacts in the signal. General advice is
to use the lowest order which sufficiently captures any rapid step-changes
in the data.</p>
<p>Filter <code>type</code> defines how the desired signal frequencies are either passed
through or rejected from the output signal. <em>Low-pass</em> and <em>high-pass</em>
filters allow only frequencies <em>lower</em> or <em>higher</em> than the critical
frequency <code>W</code> to be passed through as the output signal, respectively.
<em>Stop-band</em> defines a critical range of frequencies which are rejected
from the output signal. <em>Pass-band</em> defines a critical range of frequencies
which are passed through as the output signal.</p>
<p>The critical (cutoff) frequency is defined by <code>W</code>, a numeric scalar for
<em>low-pass</em> and <em>high-pass</em> filters, or a two-element vector <code>c(low, high)</code>
defining the lower and upper bands for <em>stop-band</em> and <em>pass-band</em> filters.
<code>W</code> represents the desired fractional critical frequency in the range
<code>W = [0, 1]</code>, where <code>1</code> is the Nyquist frequency, i.e., half the sample
rate of the data in Hz.</p>
<p>Alternatively, the critical frequency can be defined by <code>fc</code>
and <code>sample_rate</code> together. <code>fc</code> represents the desired
critical frequency in Hz, and <code>sample_rate</code> is the sample rate of the
recorded data in Hz. <code>W = fc / (sample_rate/2)</code>.</p>
<p>Defining both <code>fc</code> and <code>sample_rate</code> explicitly will
overwrite <code>W</code>.</p></dd>

<dt><code>method = "moving-average"</code></dt>
<dd><p>applies a centred (two-way symmetrical)
moving average filter from <code><a href="https://rdrr.io/pkg/zoo/man/rollapply.html" class="external-link">zoo::rollapply()</a></code>. The moving-average is
calculated over a window of width <code>width</code> defining the number of samples
between <code>[i - floor(width/2), i + floor(width/2)]</code>. A partial moving-
average will be calculated at the edges of the existing data.</p></dd>


</dl><p>Missing values (<code>NA</code>) in the numeric vector will cause an error unless
<code>na.rm = TRUE</code>. Then <code>NA</code> values are removed for processing, and restored in
the returned vector.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="va">pi</span>, len <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y_clean</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y_clean</span> <span class="op">+</span> <span class="va">noise</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y.spline</span> <span class="op">&lt;-</span> <span class="fu">filter_data</span><span class="op">(</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"smooth-spline"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> `smooth.spline()` `spar` set to <span style="color: #0000BB;">0.862</span></span>
<span class="r-in"><span><span class="va">y.LP</span> <span class="op">&lt;-</span> <span class="fu">filter_data</span><span class="op">(</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"butterworth"</span>, n <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y.MA</span> <span class="op">&lt;-</span> <span class="fu">filter_data</span><span class="op">(</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"moving-average"</span>, width <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y.spline</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y.LP</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y.MA</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"green4"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jem Arnold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

